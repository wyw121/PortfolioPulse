(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{3425:(e,t,a)=>{Promise.resolve().then(a.bind(a,2958))},2958:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var r=a(7437),s=a(495),i=a(6013),l=a(7440),n=a(8009),o=a(2468),d=a(2265);let c=d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.fC,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:(0,r.jsx)(n.z$,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})})});c.displayName=n.fC.displayName;let u=d.forwardRef((e,t)=>{let{className:a,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i})});u.displayName="Input";let f=d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("label",{ref:t,className:(0,l.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",a),...s})});f.displayName="Label";var h=a(856),m=a(2421),p=a(4392);let x=h.fC;h.ZA;let g=h.B4,b=d.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(h.xz,{ref:t,className:(0,l.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[s,(0,r.jsx)(h.JO,{asChild:!0,children:(0,r.jsx)(m.Z,{className:"h-4 w-4 opacity-50"})})]})});b.displayName=h.xz.displayName;let j=d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(h.u_,{ref:t,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(p.Z,{className:"h-4 w-4"})})});j.displayName=h.u_.displayName;let y=d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(h.$G,{ref:t,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(m.Z,{className:"h-4 w-4"})})});y.displayName=h.$G.displayName;let v=d.forwardRef((e,t)=>{let{className:a,children:s,position:i="popper",...n}=e;return(0,r.jsx)(h.h_,{children:(0,r.jsxs)(h.VY,{ref:t,className:(0,l.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...n,children:[(0,r.jsx)(j,{}),(0,r.jsx)(h.l_,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(y,{})]})})});v.displayName=h.VY.displayName,d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(h.__,{ref:t,className:(0,l.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=h.__.displayName;let w=d.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(h.ck,{ref:t,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(h.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(h.eT,{children:s})]})});w.displayName=h.ck.displayName,d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(h.Z0,{ref:t,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=h.Z0.displayName;let N=d.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});N.displayName="Textarea";var k=a(9088),C=a(8184),S=a(9827),T=a(6463);function _(){let[e,t]=(0,d.useState)(null),[a,l]=(0,d.useState)(""),[n,h]=(0,d.useState)(""),[m,p]=(0,d.useState)(""),[j,y]=(0,d.useState)(""),[_,R]=(0,d.useState)("draft"),[E,Z]=(0,d.useState)(!1),[P,z]=(0,d.useState)(!1),[H,L]=(0,d.useState)("idle"),[O,A]=(0,d.useState)(null),F=(0,T.useRouter)(),M=e=>{var t;let a=new DOMParser().parseFromString(e,"text/html"),r=a.querySelector("title"),s=(null==r?void 0:r.textContent)||"",i=a.querySelector("p");return{title:s,excerpt:(null==i?void 0:null===(t=i.textContent)||void 0===t?void 0:t.slice(0,200))||"",content:e}},B=async()=>{if(!e||!a.trim()){A("请选择文件并输入标题");return}z(!0),L("uploading"),A(null);try{let t=await e.text();L("processing");let r=M(t),s={title:a.trim(),content:r.content,excerpt:n.trim()||r.excerpt,category:m||void 0,tags:j.trim()?j.split(",").map(e=>e.trim()).filter(Boolean):[],status:_,is_featured:E};await k.Z.createPost(s),L("success"),setTimeout(()=>{F.push("/admin/blog")},1500)}catch(e){A(e instanceof Error?e.message:"上传失败"),L("error")}finally{z(!1)}};return(0,r.jsxs)("div",{className:"container max-w-2xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"上传HTML文件"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"支持上传OneNote导出的HTML文件，系统会自动解析内容并创建博客文章"})]}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"文件上传"}),(0,r.jsx)(i.SZ,{children:"请选择HTML文件并填写相关信息。支持OneNote、Word等导出的HTML格式。"})]}),(0,r.jsxs)(i.aY,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f,{htmlFor:"file",children:"选择HTML文件"}),(0,r.jsx)(u,{id:"file",type:"file",accept:".html,.htm",onChange:e=>{var r;let s=null===(r=e.target.files)||void 0===r?void 0:r[0];if(s){t(s);let e=s.name.replace(/\.(html?|htm)$/i,"");a||l(e)}},disabled:P}),e&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["已选择: ",e.name," (",(e.size/1024).toFixed(1)," KB)"]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f,{htmlFor:"title",children:"文章标题 *"}),(0,r.jsx)(u,{id:"title",value:a,onChange:e=>l(e.target.value),placeholder:"请输入文章标题",disabled:P})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f,{htmlFor:"excerpt",children:"文章摘要"}),(0,r.jsx)(N,{id:"excerpt",value:n,onChange:e=>h(e.target.value),placeholder:"留空则自动从内容中提取",rows:3,disabled:P})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f,{htmlFor:"category",children:"分类"}),(0,r.jsxs)(x,{value:m,onValueChange:p,disabled:P,children:[(0,r.jsx)(b,{children:(0,r.jsx)(g,{placeholder:"选择分类"})}),(0,r.jsxs)(v,{children:[(0,r.jsx)(w,{value:"finance",children:"金融学习"}),(0,r.jsx)(w,{value:"technology",children:"技术分享"}),(0,r.jsx)(w,{value:"life",children:"生活感悟"}),(0,r.jsx)(w,{value:"notes",children:"学习笔记"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f,{htmlFor:"tags",children:"标签"}),(0,r.jsx)(u,{id:"tags",value:j,onChange:e=>y(e.target.value),placeholder:"用逗号分隔多个标签，如：金融,投资,学习笔记",disabled:P}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"使用逗号分隔多个标签"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f,{children:"发布状态"}),(0,r.jsxs)(x,{value:_,onValueChange:e=>R(e),disabled:P,children:[(0,r.jsx)(b,{children:(0,r.jsx)(g,{})}),(0,r.jsxs)(v,{children:[(0,r.jsx)(w,{value:"draft",children:"保存为草稿"}),(0,r.jsx)(w,{value:"published",children:"立即发布"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(c,{id:"featured",checked:E,onCheckedChange:e=>Z(!0===e),disabled:P}),(0,r.jsx)(f,{htmlFor:"featured",className:"text-sm",children:"设为精选文章"})]})]}),O&&(0,r.jsx)("div",{className:"text-sm text-destructive bg-destructive/10 p-3 rounded",children:O}),(0,r.jsxs)(s.z,{onClick:B,disabled:!e||!a.trim()||P,className:"w-full",children:[(()=>{switch(H){case"uploading":return(0,r.jsx)(C.Z,{className:"w-5 h-5 animate-spin"});case"processing":return(0,r.jsx)(S.Z,{className:"w-5 h-5 animate-pulse"});case"success":return(0,r.jsx)(o.Z,{className:"w-5 h-5 text-green-500"});case"error":return(0,r.jsx)(S.Z,{className:"w-5 h-5 text-red-500"});default:return(0,r.jsx)(C.Z,{className:"w-5 h-5"})}})(),(0,r.jsx)("span",{className:"ml-2",children:(()=>{switch(H){case"uploading":return"正在上传文件...";case"processing":return"正在处理HTML内容...";case"success":return"上传成功！即将跳转...";case"error":return"上传失败";default:return"上传OneNote HTML文件"}})()})]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[(0,r.jsx)("p",{children:(0,r.jsx)("strong",{children:"使用说明："})}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,r.jsx)("li",{children:"支持OneNote「另存为HTML」导出的文件"}),(0,r.jsx)("li",{children:"支持Word、WPS等导出的HTML文件"}),(0,r.jsx)("li",{children:"文件大小限制：10MB"}),(0,r.jsx)("li",{children:"上传后会自动解析HTML内容并保持原有格式"}),(0,r.jsx)("li",{children:"图片等资源会被内嵌，确保完整显示"})]})]})]})]})]})}},495:(e,t,a)=>{"use strict";a.d(t,{z:()=>d});var r=a(7437),s=a(2265),i=a(1538),l=a(3027),n=a(7440);let o=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-300 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 font-primary",{variants:{variant:{default:"bg-gradient-primary text-white hover:shadow-lg hover:-translate-y-0.5 hover:shadow-blue-500/25",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground gradient-border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"bg-gradient-primary text-white hover:shadow-lg hover:-translate-y-1 hover:shadow-blue-500/30"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,size:l,asChild:d=!1,...c}=e,u=d?i.g7:"button";return(0,r.jsx)(u,{className:(0,n.cn)(o({variant:s,size:l,className:a})),ref:t,...c})});d.displayName="Button"},6013:(e,t,a)=>{"use strict";a.d(t,{Ol:()=>n,SZ:()=>d,Zb:()=>l,aY:()=>c,ll:()=>o});var r=a(7437),s=a(2265),i=a(7440);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});l.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",a),...s})});n.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},9088:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});let r=a(357).env.NEXT_PUBLIC_API_URL||"http://localhost:8000",s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new AbortController,r=setTimeout(()=>a.abort(),3e3);try{let s=await fetch(e,{...t,signal:a.signal});return clearTimeout(r),s}catch(e){if(clearTimeout(r),e instanceof Error&&"AbortError"===e.name)throw Error("请求超时");throw e}};class i{static async getPosts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.set("page",e.page.toString()),e.page_size&&t.set("page_size",e.page_size.toString()),e.category&&t.set("category",e.category),e.search&&t.set("search",e.search);let a=await s("".concat(r,"/api/blog/posts?").concat(t),{cache:"force-cache",next:{revalidate:300}});if(!a.ok)throw Error("获取博客文章失败");return await a.json()}static async getPostBySlug(e){try{let t=await s("".concat(r,"/api/blog/posts/").concat(e),{cache:"force-cache",next:{revalidate:600}});if(!t.ok)return null;return await t.json()}catch(e){return null}}static async getFeaturedPosts(){let e=await s("".concat(r,"/api/blog/featured"),{cache:"force-cache",next:{revalidate:300}});if(!e.ok)throw Error("获取精选文章失败");return await e.json()}static async getCategories(){let e=await fetch("".concat(r,"/api/blog/categories"),{cache:"no-store"});if(!e.ok)throw Error("获取博客分类失败");return await e.json()}static async getAllPostsAdmin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.set("page",e.page.toString()),e.page_size&&t.set("page_size",e.page_size.toString());let a=await fetch("".concat(r,"/api/admin/blog/posts?").concat(t),{cache:"no-store",headers:this.getAuthHeaders()});if(!a.ok)throw Error("获取所有文章失败");return await a.json()}static async createPost(e){let t=await fetch("".concat(r,"/api/admin/blog/posts"),{method:"POST",headers:{"Content-Type":"application/json",...this.getAuthHeaders()},body:JSON.stringify(e)});if(!t.ok)throw Error("创建文章失败");return await t.json()}static async updatePost(e,t){let a=await fetch("".concat(r,"/api/admin/blog/posts/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...this.getAuthHeaders()},body:JSON.stringify(t)});if(!a.ok)throw Error("更新文章失败");return await a.json()}static async deletePost(e){if(!(await fetch("".concat(r,"/api/admin/blog/posts/").concat(e),{method:"DELETE",headers:this.getAuthHeaders()})).ok)throw Error("删除文章失败")}static async uploadFile(e){let t=new FormData;t.append("file",e);let a=await fetch("".concat(r,"/api/admin/blog/upload"),{method:"POST",headers:this.getAuthHeaders(),body:t});if(!a.ok)throw Error("文件上传失败");return await a.json()}static getAuthHeaders(){return{}}}},7440:(e,t,a)=>{"use strict";a.d(t,{cn:()=>i});var r=a(4839),s=a(6164);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[289,504,130,215,744],()=>t(3425)),_N_E=e.O()}]);